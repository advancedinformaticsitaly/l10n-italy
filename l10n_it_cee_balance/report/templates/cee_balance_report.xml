<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="cee_balance_report_qweb">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <!-- Defines global variables used by internal layout -->
                <t t-set="title" t-value="'CEE Balance'"/>
<!--                 <t t-set="title" t-value="o.report_id.name"/> -->
<!--                 <t t-set="company_name" t-value="o.report_id.company_id.name"/> -->
<!--                 <t t-set="res_company" t-value="o.report_id.company_id"/> -->

                <t t-call="account_financial_report.internal_layout">
                    <t t-call="l10n_it_cee_balance.cee_balance_report_base"/>
                </t>
            </t>
        </t>
    </template>

    <template id="cee_balance_report_base">
        <!-- Saved flag fields into variables, used to define columns display -->
<!--         <t t-set="show_analytic_tags" t-value="o.show_analytic_tags"/> -->

        <div class="page">
            <!-- Display filters -->
            <t t-call="account_financial_report.report_trial_balance_filters"/>

            <div class="act_as_table data_table" style="width: 100%;">
            <!-- Display account lines -->
            <t t-if="not show_partner_details">
                <div class="act_as_table" style="width: 48%;float:left;">
                    <!-- Display account header -->
                    <t t-call="l10n_it_cee_balance.report_trial_balance_lines_header"/>
                    
                    <!-- Display each lines -->
                    <t t-foreach="o.account_ids.filtered(lambda a: not a.hide_line)" t-as="line">
                        <t t-set="type" t-value='"account_type"'/>
                        <!-- Adapt -->
                        <t t-set="style" t-value="'font-size:8px;'"/>
                        <t t-set="padding" t-value="line.level * 4"/>
                        <t t-if="o.hide_account_at_0">
                            <t t-set="style" t-value="'font-size: 14px;'"/>
                        </t>
                        <t t-if="o.hierarchy_on != 'none'">
                            <t t-set="style" t-value="'font-size: ' + str(14 - line.level) + 'px; margin-left: ' + str(line.level * 4) + 'px;'"/>
                        </t>
                        <t t-if="line.account_group_cee_id">
                            <t t-set="style" t-value="style + 'font-weight: bold; color: blue;'"/>
                        </t>
                        
                        <!-- Display account lines -->
                        <t t-call="l10n_it_cee_balance.report_trial_balance_line"/>
                        <!-- Adapt style -->
                    </t>
                </div>
            </t>
            </div>

        </div>
    </template>


    <template id="l10n_it_cee_balance.report_trial_balance_lines_header">
        <!-- Display table headers for lines -->
        <div class="act_as_thead">
            <div class="act_as_row labels">
                <t t-if="not show_partner_details">
                    <!--## Code-->
                    <div class="act_as_cell" style="width: 8.86%;">Code</div>
                    <!--## Account-->
                    <div class="act_as_cell" style="width: 37.58%;">Account
                    </div>
                </t>
                <t t-if="show_partner_details">
                    <!--## Partner-->
                    <div class="act_as_cell" style="width: 46.44%;">Partner
                    </div>
                </t>
                <!--## Initial balance-->
<!--                 <div class="act_as_cell" style="width: 9.64%;">Initial -->
<!--                     balance</div> -->
<!--                 ## Debit -->
<!--                 <div class="act_as_cell" style="width: 9.64%;">Debit</div> -->
<!--                 ## Credit -->
<!--                 <div class="act_as_cell" style="width: 9.64%;">Credit</div> -->
<!--                 ## Period balance -->
<!--                 <div class="act_as_cell" style="width: 9.64%;">Period balance</div> -->
                ## Ending balance
                <div class="act_as_cell" style="width: 9.64%;">Ending balance</div>
                <t t-if="foreign_currency">
                    <!--## currency_name-->
                    <div class="act_as_cell" style="width: 4.43%;">Cur.</div>
                    <!--## amount_currency-->
                    <div class="act_as_cell" style="width: 8.86%;">Initial blance cur.</div>
                    <div class="act_as_cell" style="width: 8.86%;">Ending blance cur.</div>
                </t>
            </div>
        </div>
    </template>


    <template id="l10n_it_cee_balance.report_trial_balance_line">
        <!-- # line -->
        <div class="act_as_row lines">
            <t t-if="not show_partner_details">
                <!--## Code-->
                <div class="act_as_cell left">
                    <t t-if="line.account_id">
                        <t t-set="res_model" t-value="'account.account'"/>
                        <span>
                            <a t-att-data-active-id="line.account_id.id"
                               t-att-data-res-model="res_model"
                               class="o_account_financial_reports_web_action"
                               t-att-style="style">
                                <t t-att-style="style" t-raw="line.code"/></a>
                        </span>
                    </t>
                    <t t-if="line.account_group_cee_id">
                        <t t-set="res_model" t-value="'account.group.cee'"/>
                        <span>
                            <a t-att-data-active-id="line.account_group_cee_id.id"
                               t-att-data-res-model="res_model"
                               class="o_account_financial_reports_web_action"
                               t-att-style="style">
                                <t t-att-style="style" t-raw="line.code"/></a>
                        </span>
                    </t>
                </div>
            </t>
            <!--## Account/Partner-->
            <div class="act_as_cell left">
                <t t-if="type == 'account_type'">
                    <t t-set="account_or_partner_line" t-value="line"/>
                    <t t-if="line.account_id">
                        <t t-set="res_model" t-value="'account.account'"/>
                        <span>
                            <a t-att-data-active-id="line.account_id.id"
                               t-att-data-res-model="res_model"
                               class="o_account_financial_reports_web_action"
                               t-att-style="style">
                                <t t-att-style="style" t-raw="line.name"/></a>
                        </span>
                    </t>
                    <t t-if="line.account_group_cee_id">
                        <t t-set="res_model" t-value="'account.group.cee'"/>
                        <span>
                            <a t-att-data-active-id="line.account_group_cee_id.id"
                               t-att-data-res-model="res_model"
                               class="o_account_financial_reports_web_action"
                               t-att-style="style">
                                <t t-att-style="style" t-raw="line.name"/></a>
                        </span>
                    </t>
                </t>
                <t t-if="type == 'partner_type'">
                    <t t-set="account_or_partner_line" t-value="line.report_account_id"/>
                    <t t-set="res_model" t-value="'res.partner'"/>
                    <span>
                        <a t-att-data-active-id="line.partner_id.id"
                            t-att-data-res-model="res_model"
                            class="o_account_financial_reports_web_action"
                            t-att-style="style">
                            <t t-att-style="style" t-raw="line.name"/></a>
                    </span>
                </t>
            </div>

            <!--## Ending balance-->
            <div class="act_as_cell amount">
                <t t-if="type == 'account_type'">
                    <t t-if="line.account_id">
                        <t t-set="domain"
                           t-value="[('account_id', '=', line.account_id.id)]"/>
                        <span>
                            <a t-att-data-domain="domain"
                               t-att-data-res-model="'account.move.line'"
                               class="o_account_financial_reports_web_action_monetary_multi"
                               t-att-style="style">
                            <t t-att-style="style" t-raw="line.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                        </span>
                    </t>
                    <t t-if="line.account_group_cee_id">
                        <t t-set="domain"
                           t-value="[('account_id', 'in', line.compute_account_ids.ids)]"/>
                        <span>
                            <a t-att-data-domain="domain"
                               t-att-data-res-model="'account.move.line'"
                               class="o_account_financial_reports_web_action_monetary_multi"
                               t-att-style="style">
                            <t t-att-style="style" t-raw="line.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                        </span>
                    </t>
                </t>
                <t t-if="type == 'partner_type'">
                    <t t-set="domain"
                       t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                 ('partner_id', '=', line.partner_id.id)]"/>
                    <span>
                        <a t-att-data-domain="domain"
                           t-att-data-res-model="'account.move.line'"
                           class="o_account_financial_reports_web_action_monetary_multi"
                           t-att-style="style">
                        <t t-att-style="style" t-raw="line.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                    </span>
                </t>
            </div>
            <t t-if="foreign_currency">
                <t t-if="account_or_partner_line.currency_id">
                    <!--## currency_name-->
                    <div class="act_as_cell" style="width: 4.43%;">
                        <span t-field="account_or_partner_line.currency_id.display_name"/>
                    </div>
                    <!--## Initial balance cur.-->
                     <div class="act_as_cell amount">
                        <t t-if="type == 'account_type'">
                            <t t-if="line.account_id">
                                <t t-set="domain"
                                   t-value="[('account_id', '=', line.account_id.id)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                       t-att-data-res-model="'account.move.line'"
                                       class="o_account_financial_reports_web_action_monetary_multi"
                                       t-att-style="style">
                                    <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/></a>
                                </span>
                            </t>
                            <t t-if="line.account_group_cee_id">
                                <t t-set="domain"
                                   t-value="[('account_id', 'in', line.compute_account_ids.ids)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                       t-att-data-res-model="'account.move.line'"
                                       class="o_account_financial_reports_web_action_monetary_multi"
                                       t-att-style="style">
                                    <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/></a>
                                </span>
                            </t>
                        </t>
                        <t t-if="type == 'partner_type'">
                            <t t-set="domain"
                               t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                         ('partner_id', '=', line.partner_id.id)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                   t-att-data-res-model="'account.move.line'"
                                   class="o_account_financial_reports_web_action_monetary_multi"
                                   t-att-style="style">
                                <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.report_account_id.currency_id}"/></a>
                            </span>
                        </t>
                    </div>
                    <!--## Ending balance cur.-->
                    <div class="act_as_cell amount">
                        <t t-if="type == 'account_type'">
                            <t t-if="line.account_id">
                                <t t-set="domain"
                                   t-value="[('account_id', '=', line.account_id.id)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                       t-att-data-res-model="'account.move.line'"
                                       class="o_account_financial_reports_web_action_monetary_multi"
                                       t-att-style="style">
                                    <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/></a>
                                </span>
                            </t>
                            <t t-if="line.account_group_cee_id">
                                <t t-set="domain"
                                   t-value="[('account_id', 'in', line.compute_account_ids.ids)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                       t-att-data-res-model="'account.move.line'"
                                       class="o_account_financial_reports_web_action_monetary_multi"
                                       t-att-style="style">
                                    <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/></a>
                                </span>
                            </t>
                        </t>
                        <t t-if="type == 'partner_type'">
                            <t t-set="domain"
                               t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                         ('partner_id', '=', line.partner_id.id)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                   t-att-data-res-model="'account.move.line'"
                                   class="o_account_financial_reports_web_action_monetary_multi"
                                   t-att-style="style">
                                <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.report_account_id.currency_id}"/></a>
                            </span>
                        </t>
                    </div>
                </t>
                <t t-if="not account_or_partner_line.currency_id.id">
                    <!--## balance_currency-->
                    <div class="act_as_cell"/>
                    <div class="act_as_cell"/>
                    <div class="act_as_cell"/>
                </t>
            </t>
        </div>
    </template>
</odoo>
